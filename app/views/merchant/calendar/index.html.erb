<div class="min-h-screen">
  <!-- soft background -->
  <div class="pointer-events-none fixed inset-0"
       style="background:
         radial-gradient(900px 520px at 15% 10%, rgba(47,102,255,0.18) 0%, rgba(11,31,70,0) 60%),
         radial-gradient(900px 520px at 85% 20%, rgba(124,58,237,0.12) 0%, rgba(11,31,70,0) 60%),
         linear-gradient(180deg, #0b1f46 0%, #07142c 100%);">
  </div>

  <div class="relative max-w-7xl mx-auto px-4 sm:px-6 py-10">
    <!-- header -->
    <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6">
      <div>
        <p class="text-white/70 text-sm font-semibold">Merchant</p>
        <h1 class="mt-2 text-3xl font-semibold text-white">Calendar</h1>
        <p class="mt-2 text-white/70">
          Manage your week at a glance. Bookings will appear here once connected.
        </p>
      </div>

      <div class="flex flex-wrap items-center gap-2">
        <%= link_to "Today",
            merchant_calendar_path(date: Date.current),
            class: "rounded-full px-4 py-2 text-sm font-semibold border border-white/15 bg-white/10 text-white hover:bg-white/15 backdrop-blur" %>

        <%= link_to "←",
            merchant_calendar_path(date: @date - 7.days),
            class: "rounded-full px-4 py-2 text-sm font-semibold border border-white/15 bg-white/10 text-white hover:bg-white/15 backdrop-blur" %>

        <%= link_to "→",
            merchant_calendar_path(date: @date + 7.days),
            class: "rounded-full px-4 py-2 text-sm font-semibold border border-white/15 bg-white/10 text-white hover:bg-white/15 backdrop-blur" %>

        <div class="rounded-full px-4 py-2 text-sm font-semibold border border-white/15 bg-white/10 text-white/90 backdrop-blur">
          Week of <span class="text-white"><%= @week_start.strftime("%d %b %Y") %></span>
        </div>
      </div>
    </div>

    <!-- main layout -->
    <div class="mt-8 grid grid-cols-1 lg:grid-cols-12 gap-6">
      <!-- left: week grid -->
      <div class="lg:col-span-9">
        <div class="rounded-3xl border border-white/15 bg-white/10 backdrop-blur shadow-lg overflow-hidden">
          <!-- day header row -->
          <div class="grid grid-cols-8 border-b border-white/10">
            <div class="p-4 text-white/60 text-sm font-semibold">Time</div>
            <% @week_days.each do |day| %>
              <div class="p-4 border-l border-white/10">
                <p class="text-white text-sm font-semibold"><%= day.strftime("%a") %></p>
                <p class="text-white/70 text-xs"><%= day.strftime("%d %b") %></p>
              </div>
            <% end %>
          </div>

          <!-- grid body -->
          <div class="grid grid-cols-8">
            <% @hours.each do |hour| %>
              <!-- time column -->
              <div class="p-4 border-b border-white/10 text-white/60 text-sm font-semibold">
                <%= "%02d:00" % hour %>
              </div>

              <% @week_days.each do |day| %>
                <% bookings_here = (@bookings_by_day_hour || {}).dig(day, hour) || [] %>

                <div class="relative p-3 border-l border-b border-white/10 min-h-[76px]">
                  <!-- base slot -->
                  <div class="h-full rounded-2xl border border-white/10 bg-white/5 hover:bg-white/10 transition p-2">
                    <% if bookings_here.any? %>
                      <% bookings_here.each do |b| %>
                        <div class="mb-2 last:mb-0 rounded-xl bg-white/15 border border-white/10 p-2">
                          <p class="text-white text-xs font-semibold truncate">
                            <%= b.user&.email || "Customer" %>
                          </p>
                          <p class="text-white/70 text-[11px] truncate">
                            <% svc = b.booking_items.first&.service %>
                            <%= svc&.name || "Booking" %>
                          </p>
                        </div>
                      <% end %>
                    <% else %>
                      <p class="text-white/30 text-[11px]">—</p>
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>

        <% if @bookings.blank? %>
          <div class="mt-6 rounded-3xl border border-white/15 bg-white/10 backdrop-blur p-6 text-white/80">
            <p class="font-semibold text-white">No bookings showing yet</p>
            <p class="mt-2 text-sm text-white/70">
              Once customers book services, bookings will appear inside this grid automatically.
            </p>
          </div>
        <% end %>
      </div>

      <!-- right: sidebar -->
      <div class="lg:col-span-3 space-y-6">
        <div class="rounded-3xl border border-white/15 bg-white/10 backdrop-blur shadow-lg p-6">
          <p class="text-white font-semibold">Quick actions</p>

          <div class="mt-4 space-y-3">
            <%= link_to "Add a service",
                merchant_services_path,
                class: "block text-center rounded-xl px-5 py-3 font-semibold text-white shadow-sm",
                style: "background:#2f66ff;" %>

            <%= link_to "View services",
                merchant_services_path,
                class: "block text-center rounded-xl px-5 py-3 font-semibold border border-white/15 bg-white/10 text-white hover:bg-white/15" %>
          </div>
        </div>

        <div class="rounded-3xl border border-white/15 bg-white/10 backdrop-blur shadow-lg p-6">
          <p class="text-white font-semibold">This week</p>
          <p class="mt-2 text-sm text-white/70">
            <%= @week_start.strftime("%d %b") %> → <%= (@week_start + 6.days).strftime("%d %b") %>
          </p>

          <div class="mt-4 space-y-3">
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
              <p class="text-sm text-white/80">Bookings</p>
              <p class="mt-2 text-2xl font-semibold text-white"><%= @bookings.size %></p>
            </div>
          </div>
        </div>
      </div>
    </div><!-- /grid -->
  </div>
</div>
